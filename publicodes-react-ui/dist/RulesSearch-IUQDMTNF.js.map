{"version":3,"sources":["../src/rule/RulesSearch.tsx"],"sourcesContent":["import { useContext, useEffect, useState } from 'react'\nimport { useEngine } from '../hooks'\nimport { styled } from 'styled-components'\nimport Fuse from 'fuse.js'\nimport { RuleLinkWithContext } from '../RuleLink'\nimport { DottedNameContext } from '../contexts'\n\ntype SearchableRule = {\n\tname: string\n\ttitle?: string\n}\n\nexport default function RulesSearch() {\n\tconst engine = useEngine()\n\tconst dottedName = useContext(DottedNameContext)\n\tconst rules: SearchableRule[] = Object.entries(engine.getParsedRules()).map(\n\t\t([name, rule]) => {\n\t\t\treturn { name, title: rule?.rawNode?.titre }\n\t\t},\n\t)\n\tconst [searchResults, setSearchResults] = useState<SearchableRule[]>([])\n\tconst [searchQuery, setSearchQuery] = useState('')\n\n\tconst fuse = new Fuse(rules, { keys: ['title', 'name'] })\n\n\tuseEffect(() => {\n\t\tsetSearchQuery('')\n\t}, [dottedName])\n\n\tuseEffect(() => {\n\t\tconst results = fuse.search(searchQuery, { limit: 10 })\n\t\tsetSearchResults(results.map((result) => result.item))\n\t}, [searchQuery])\n\n\tconst isEmpty = searchResults.length === 0\n\n\treturn (\n\t\t<SearchContainer id=\"documentation-search\">\n\t\t\t<SearchInput\n\t\t\t\tid=\"documentation-search-input\"\n\t\t\t\ttype=\"text\"\n\t\t\t\tplaceholder=\"Chercher une rÃ¨gle\"\n\t\t\t\tvalue={searchQuery}\n\t\t\t\tonChange={(e) => setSearchQuery(e.target.value)}\n\t\t\t\tonFocus={(e) => setSearchQuery(e.target.value)}\n\t\t\t\tempty={isEmpty}\n\t\t\t/>\n\t\t\t{!isEmpty ?\n\t\t\t\t<SearchResults id=\"documentation-search-results\">\n\t\t\t\t\t{searchResults.map(({ name, title }, i) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<SearchItem\n\t\t\t\t\t\t\t\tkey={name}\n\t\t\t\t\t\t\t\tid=\"documentation-search-item\"\n\t\t\t\t\t\t\t\tisLast={i === searchResults.length - 1}\n\t\t\t\t\t\t\t\tonClick={() => setSearchQuery('')}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<RuleLinkWithContext dottedName={name}>\n\t\t\t\t\t\t\t\t\t<ItemContent onClick={() => setSearchQuery('')}>\n\t\t\t\t\t\t\t\t\t\t<ItemName id=\"documentation-search-item-name\">\n\t\t\t\t\t\t\t\t\t\t\t{name}\n\t\t\t\t\t\t\t\t\t\t</ItemName>\n\t\t\t\t\t\t\t\t\t\t<ItemTitle id=\"documentation-search-item-title\">\n\t\t\t\t\t\t\t\t\t\t\t{title}\n\t\t\t\t\t\t\t\t\t\t</ItemTitle>\n\t\t\t\t\t\t\t\t\t</ItemContent>\n\t\t\t\t\t\t\t\t</RuleLinkWithContext>\n\t\t\t\t\t\t\t</SearchItem>\n\t\t\t\t\t\t)\n\t\t\t\t\t})}\n\t\t\t\t</SearchResults>\n\t\t\t:\tnull}\n\t\t</SearchContainer>\n\t)\n}\n\nconst SearchContainer = styled.div`\n\tmargin-bottom: 1rem;\n\tmargin-right: 1rem;\n\tmax-width: 350px;\n`\n\nconst SearchInput = styled.input<{ empty: boolean }>`\n\twidth: 100%;\n\tpadding: 0.5rem;\n\tborder: 1px solid #ccc;\n\tborder-radius: ${({ empty }) => (empty ? '5px' : '5px 5px 0 0')};\n\n\t&:focus {\n\t\toutline: none;\n\t\tborder: 1px solid #666;\n\t}\n`\n\nconst SearchResults = styled.div`\n\tbackground-color: white;\n\tborder: 1px solid #ccc;\n\tborder-top: none;\n\tborder-radius: 0 0 0.25rem 0.25rem;\n\tposition: relative;\n`\n\nconst SearchItem = styled.div<{ isLast: boolean }>`\n\tpadding: 0.5rem;\n\tborder-bottom: ${({ isLast }) => (isLast ? 'none' : '1px solid #e6e6e6')};\n\tborder-left: 2px solid transparent;\n\tborder-radius: ${({ isLast }) => (isLast ? '0 0 0.25rem 0.25rem' : '0')};\n\n\t&:hover {\n\t\tbackground-color: #f6f6f6;\n\t}\n`\nconst ItemContent = styled.span`\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tflex-gap: 0.5rem;\n\talign-items: center;\n`\n\nconst ItemName = styled.span`\n\twidth: 100%;\n`\nconst ItemTitle = styled.span`\n\tcolor: #666;\n`\n"],"mappings":";;;;;;;AAAA,SAAS,YAAY,WAAW,gBAAgB;AAEhD,SAAS,cAAc;AACvB,OAAO,UAAU;AAmCd,cAoBM,YApBN;AA1BY,SAAR,cAA+B;AACrC,QAAM,SAAS,UAAU;AACzB,QAAM,aAAa,WAAW,iBAAiB;AAC/C,QAAM,QAA0B,OAAO,QAAQ,OAAO,eAAe,CAAC,EAAE;AAAA,IACvE,CAAC,CAAC,MAAM,IAAI,MAAM;AACjB,aAAO,EAAE,MAAM,OAAO,MAAM,SAAS,MAAM;AAAA,IAC5C;AAAA,EACD;AACA,QAAM,CAAC,eAAe,gBAAgB,IAAI,SAA2B,CAAC,CAAC;AACvE,QAAM,CAAC,aAAa,cAAc,IAAI,SAAS,EAAE;AAEjD,QAAM,OAAO,IAAI,KAAK,OAAO,EAAE,MAAM,CAAC,SAAS,MAAM,EAAE,CAAC;AAExD,YAAU,MAAM;AACf,mBAAe,EAAE;AAAA,EAClB,GAAG,CAAC,UAAU,CAAC;AAEf,YAAU,MAAM;AACf,UAAM,UAAU,KAAK,OAAO,aAAa,EAAE,OAAO,GAAG,CAAC;AACtD,qBAAiB,QAAQ,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC;AAAA,EACtD,GAAG,CAAC,WAAW,CAAC;AAEhB,QAAM,UAAU,cAAc,WAAW;AAEzC,SACC,qBAAC,mBAAgB,IAAG,wBACnB;AAAA;AAAA,MAAC;AAAA;AAAA,QACA,IAAG;AAAA,QACH,MAAK;AAAA,QACL,aAAY;AAAA,QACZ,OAAO;AAAA,QACP,UAAU,CAAC,MAAM,eAAe,EAAE,OAAO,KAAK;AAAA,QAC9C,SAAS,CAAC,MAAM,eAAe,EAAE,OAAO,KAAK;AAAA,QAC7C,OAAO;AAAA;AAAA,IACR;AAAA,IACC,CAAC,UACD,oBAAC,iBAAc,IAAG,gCAChB,wBAAc,IAAI,CAAC,EAAE,MAAM,MAAM,GAAG,MAAM;AAC1C,aACC;AAAA,QAAC;AAAA;AAAA,UAEA,IAAG;AAAA,UACH,QAAQ,MAAM,cAAc,SAAS;AAAA,UACrC,SAAS,MAAM,eAAe,EAAE;AAAA,UAEhC,8BAAC,uBAAoB,YAAY,MAChC,+BAAC,eAAY,SAAS,MAAM,eAAe,EAAE,GAC5C;AAAA,gCAAC,YAAS,IAAG,kCACX,gBACF;AAAA,YACA,oBAAC,aAAU,IAAG,mCACZ,iBACF;AAAA,aACD,GACD;AAAA;AAAA,QAdK;AAAA,MAeN;AAAA,IAEF,CAAC,GACF,IACC;AAAA,KACH;AAEF;AAEA,IAAM,kBAAkB,OAAO;AAAA;AAAA;AAAA;AAAA;AAM/B,IAAM,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA,kBAIT,CAAC,EAAE,MAAM,MAAO,QAAQ,QAAQ,aAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQhE,IAAM,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ7B,IAAM,aAAa,OAAO;AAAA;AAAA,kBAER,CAAC,EAAE,OAAO,MAAO,SAAS,SAAS,mBAAoB;AAAA;AAAA,kBAEvD,CAAC,EAAE,OAAO,MAAO,SAAS,wBAAwB,GAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAMxE,IAAM,cAAc,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAO3B,IAAM,WAAW,OAAO;AAAA;AAAA;AAGxB,IAAM,YAAY,OAAO;AAAA;AAAA;","names":[]}